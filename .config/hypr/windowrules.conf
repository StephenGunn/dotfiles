##############################
### WINDOWS AND WORKSPACES ###
##############################

# See https://wiki.hyprland.org/Configuring/Window-Rules/ for more

###################
### PRIVACY     ###
###################

# Red border for privacy-blurred windows
windowrule {
    name = privacy-blur-border
    match:tag = privacy-blur

    border_color = rgb(ff5555)
}

###################
### GENERAL     ###
###################

# Center floating windows (exclude apps with relative popups/menus)
windowrule {
    name = center-floating
    match:float = true
    match:class = ^(?!zoom|krita|Krita|Gimp|gimp|inkscape|Inkscape|libreoffice|LibreOffice).*$

    center = on
}

# Suppress maximize event for all windows
windowrule {
    name = suppress-maximize
    match:class = .*

    suppress_event = maximize
}

###################
### SCRATCHPADS ###
###################

# Scratchpad workspaces
workspace = special:magic, on-created-empty:ghostty, persistent:false
workspace = special:browser, on-created-empty:firefox, persistent:false
workspace = special:wallpaper, persistent:false
workspace = special:dotfiles, persistent:false

# Ghostty scratchpad
# Match by workspace since --class flag doesn't work with Ghostty
# NOTE: Using move instead of center because multiple windowrules with the same
# match criteria don't cleanly override - they conflict. The toggle-scratchpad.sh
# script handles repositioning when streaming mode is active.
windowrule {
    name = ghostty-scratchpad
    float = on
    size = (monitor_w*0.75) (monitor_h*0.86)
    move = (monitor_w*0.125) (monitor_h*0.07)
    persistent_size = off
    match:class = ^(com\.mitchellh\.ghostty)$
    match:workspace = special:magic
}

# Firefox scratchpad
windowrule {
    name = firefox-browser-scratchpad
    float = on
    size = (monitor_w*0.75) (monitor_h*0.86)
    center = on
    persistent_size = off
    match:class = ^(firefox)$
    match:workspace = special:browser
}

# Dotfiles scratchpad
windowrule {
    name = dotfiles-scratchpad
    float = on
    size = (monitor_w*0.75) (monitor_h*0.86)
    center = on
    persistent_size = off
    match:class = ^(com\.mitchellh\.ghostty)$
    match:workspace = special:dotfiles
}

###################
### CMATRIX     ###
###################

# Cmatrix screensaver on monitor 0 (main)
windowrule {
    name = cmatrix-1-fullscreen
    match:class = ^(cmatrix-1)$

    fullscreen = on
    monitor = 0
}

# Cmatrix screensaver on monitor 1 (vertical)
windowrule {
    name = cmatrix-2-fullscreen
    match:class = ^(cmatrix-2)$

    fullscreen = on
    monitor = 1
}

###################
### STREAMING   ###
###################

# Webcam face - top position in sidebar (16:9 aspect)
# X: 2560 - 20 (gaps_out) - 430 (width) = 2110
# Y: 47 (panel) + 20 (gaps_out) = 67
windowrule {
    name = streaming-webcam-face
    match:title = ^(webcam-face)$

    float = on
    pin = on
    monitor = 0
    move = 2110 68
    size = 430 242
    no_focus = on
}

# Webcam topdown - below face cam (16:9 aspect)
# Y: 70 + 242 + 20 (gutter) = 332
windowrule {
    name = streaming-webcam-topdown
    match:title = ^(webcam-topdown)$

    float = on
    pin = on
    monitor = 0
    move = 2110 332
    size = 430 242
    no_focus = on
}

# Screenkey window
windowrule {
    name = streaming-screenkey
    match:class = ^(Screenkey)$

    float = on
    pin = on
    no_focus = on
}

# Streaming widgets - fill space under webcams
# Y: 574 (bottom of topdown) + 20 (gap) = 594
# Height: 1440 - 20 (bottom gap) - 594 = 826
windowrule {
    name = streaming-bonsai
    match:title = ^(streaming-bonsai)$

    float = on
    pin = on
    monitor = 0
    move = 2110 594
    size = 430 826
    no_focus = on
}

windowrule {
    name = streaming-cmatrix
    match:title = ^(streaming-cmatrix)$

    float = on
    pin = on
    monitor = 0
    move = 2110 594
    size = 430 826
    no_focus = on
}

windowrule {
    name = streaming-cava
    match:title = ^(streaming-cava)$

    float = on
    pin = on
    monitor = 0
    move = 2110 594
    size = 430 826
    no_focus = on
}

windowrule {
    name = streaming-pipes
    match:title = ^(streaming-pipes)$

    float = on
    pin = on
    monitor = 0
    move = 2110 594
    size = 430 826
    no_focus = on
}

###################
### KEYMAP      ###
###################

# Keymap viewer (imv)
windowrule {
    name = keymap-viewer
    match:class = ^(imv)$

    float = on
    size = (monitor_w*0.80) (monitor_h*0.80)
    center = on
    persistent_size = off
}

###################
### ZOOM        ###
###################

# Let Zoom manage its own windows - don't force float/tile
# (excluded from center-floating rule above)

###################
### KRITA       ###
###################

# Let Krita manage its own windows - don't force float/tile
# (excluded from center-floating rule above)
